<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<title>Spawning TFS2015 Build Agents with Docker - Dev&Ops</title><meta name=description content="The Microsoft Open Source train keeps rolling fast forward with more and more projects popping up on GitHub. When we upgraded to TFS2015 late last year, the support for Linux build agents was so-so. A couple of weeks ago I decided to check in again.
To my delight I discovered that the &ldquo;old&rdquo; build agent had been depricated and the new one has been implementet using dotnet core. That means cross-platform awesomeness!">
<meta name=author content="Andreas Mosti">
<link rel="preload stylesheet" as=style href=https://andmos.github.io/blog.amosti.net/app.min.css>
<link rel=preload as=image href=https://andmos.github.io/blog.amosti.net/theme.png>
<link rel=preload as=image href=https://andmos.github.io/blog.amosti.net/twitter.svg>
<link rel=preload as=image href=https://andmos.github.io/blog.amosti.net/github.svg>
<link rel=icon href=https://andmos.github.io/blog.amosti.net/favicon.ico>
<link rel=apple-touch-icon href=https://andmos.github.io/blog.amosti.net/apple-touch-icon.png>
<meta name=generator content="Hugo 0.93.0">
<meta property="og:title" content="Spawning TFS2015 Build Agents with Docker">
<meta property="og:description" content="The Microsoft Open Source train keeps rolling fast forward with more and more projects popping up on GitHub. When we upgraded to TFS2015 late last year, the support for Linux build agents was so-so. A couple of weeks ago I decided to check in again.
To my delight I discovered that the &ldquo;old&rdquo; build agent had been depricated and the new one has been implementet using dotnet core. That means cross-platform awesomeness!">
<meta property="og:type" content="article">
<meta property="og:url" content="https://andmos.github.io/blog.amosti.net/spawning-tfs2015-build-agents-with-docker/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2016-09-24T10:48:56+00:00">
<meta property="article:modified_time" content="2016-09-24T10:48:56+00:00">
<meta itemprop=name content="Spawning TFS2015 Build Agents with Docker">
<meta itemprop=description content="The Microsoft Open Source train keeps rolling fast forward with more and more projects popping up on GitHub. When we upgraded to TFS2015 late last year, the support for Linux build agents was so-so. A couple of weeks ago I decided to check in again.
To my delight I discovered that the &ldquo;old&rdquo; build agent had been depricated and the new one has been implementet using dotnet core. That means cross-platform awesomeness!"><meta itemprop=datePublished content="2016-09-24T10:48:56+00:00">
<meta itemprop=dateModified content="2016-09-24T10:48:56+00:00">
<meta itemprop=wordCount content="314">
<meta itemprop=keywords content>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Spawning TFS2015 Build Agents with Docker">
<meta name=twitter:description content="The Microsoft Open Source train keeps rolling fast forward with more and more projects popping up on GitHub. When we upgraded to TFS2015 late last year, the support for Linux build agents was so-so. A couple of weeks ago I decided to check in again.
To my delight I discovered that the &ldquo;old&rdquo; build agent had been depricated and the new one has been implementet using dotnet core. That means cross-platform awesomeness!">
</head><body class=not-ready data-menu=true>
<header class=header>
<p class=logo>
<a class=site-name href=https://andmos.github.io/blog.amosti.net>Dev&Ops</a><a class=btn-dark></a>
</p><script>let bodyClx=document.body.classList,btnDark=document.querySelector(".btn-dark"),sysDark=window.matchMedia("(prefers-color-scheme: dark)"),darkVal=localStorage.getItem("dark"),setDark=e=>{bodyClx[e?"add":"remove"]("dark"),localStorage.setItem("dark",e?"yes":"no")};setDark(darkVal?darkVal==="yes":sysDark.matches),requestAnimationFrame(()=>bodyClx.remove("not-ready")),btnDark.addEventListener("click",()=>setDark(!bodyClx.contains("dark"))),sysDark.addEventListener("change",e=>setDark(e.matches))</script>
<nav class=menu>
<a href=/blog.amosti.net/about/>About Andreas</a>
</nav><nav class=social>
<a class=twitter style=--url:url(./twitter.svg) href=https://twitter.com/amostii target=_blank></a>
<a class=github style=--url:url(./github.svg) href=https://github.com/andmos target=_blank></a>
</nav></header><main class=main>
<article class=post-single>
<header class=post-title>
<p>
<time>Sep 24, 2016</time>
<span>Andreas Mosti</span>
</p><h1>Spawning TFS2015 Build Agents with Docker</h1></header><section class=post-content><p>The Microsoft Open Source train keeps rolling fast forward with more and more projects popping up on GitHub. When we upgraded to TFS2015 late last year, the support for Linux build agents was so-so.
A couple of weeks ago I decided to check in again.</p><p>To my delight I discovered that the &ldquo;old&rdquo; <a href=https://github.com/Microsoft/vso-agent>build agent had been depricated</a> and the <a href=https://github.com/Microsoft/vsts-agent>new one</a> has been implementet using <a href=https://www.microsoft.com/net/core#macos>dotnet core</a>.
That means cross-platform awesomeness!</p><p>It is now easy to install the agent on OSX, Ubuntu, the Red Hat family and so on.
That makes TFS much more accessible for people building other stuff than .NET. TFS has become a great product over the years, so this realy neat.</p><p>This also means that Docker can be used to spawn build agents on the fly. Somethimes we don&rsquo;t need to have build agents standing idle hours on end. Docker is great for spawning the agent when it actually is needed. It also allows us to install the relevant build-environment for each case. If you want to build Java, we can create a build agent with Java. Or Node. Or Mono.</p><p>The following <code>Dockerfile</code> gives you the idea:</p><pre tabindex=0><code>FROM java

RUN useradd -ms /bin/bash builder
WORKDIR /home/builder

RUN apt-get update &amp;&amp; apt-get install -y libunwind8 libcurl3 libicu52 &amp;&amp; apt-get install wget

RUN mkdir buildAgent &amp;&amp; cd buildAgent
RUN wget https://github.com/Microsoft/vsts-agent/releases/download/v2.107.0/vsts-agent-ubuntu.14.04-x64-2.107.0.tar.gz
RUN tar xzf vsts-agent-ubuntu.14.04-x64-2.107.0.tar.gz

USER builder
CMD ./config.sh &amp;&amp; ./run.sh
</code></pre><p>The <code>Dockerfile</code> itself installs the build agent and starts an interactive configuration before starting the agent. The neat part is the <code>FROM</code> keyword. In this example, I want to build some Java code, so I base the file on the Java image.</p><p>Another tip is the scriptable setup of the agent. The <code>config.sh</code> script can be triggered noninteractive:</p><pre tabindex=0><code>docker run -it andmos/vsts-agent ./config.sh --unattended --acceptteeeula --url http://mylocaltfsserver:8080/tfs --auth Negotiate --username DOMAIN\USER_NAME --password MyPassword --pool default --agent myagent &amp;&amp; ./run.sh
</code></pre></section><nav class=post-nav>
<a class=prev href=https://andmos.github.io/blog.amosti.net/rolling-out-web-services-with-topshelf-chocolatey-and-ansible/><span>←</span><span>Rolling out web services with Topshelf, Chocolatey and Ansible</span></a>
<a class=next href=https://andmos.github.io/blog.amosti.net/dockercon-2016-docker-nails-iterative-open-source-development/><span>DockerCon 2016: Docker nails iterative open source development</span><span>→</span></a>
</nav></article></main><footer class=footer>
<p>&copy; 2022 <a href=https://andmos.github.io/blog.amosti.net>Dev&Ops</a></p><p>Powered by <a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>️</p><p>
<a href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>Paper 5.1</a>
</p></footer></body></html>