<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<title>Github Actions and publishing artifacts to Azure Blob Storage - Dev&Ops</title>
<meta name=description content="Intro Github Actions is a welcomed edition to the (still) growing world of CI/CD tools. Since Actions is Github&rsquo;s own tool, it integrates more closely to your repo and the Github Workflow, with actions to automate tasks around issues, pull-requests, releases etc. Writing a task that regularly, say, check issues and mark them as stalled if it hasn&rsquo;t been any activity for some time has, would mean leveraging the Github API when running in other tools, while abstractions for these kinds of integrations are present directly in Github Actions.">
<meta name=author content="Andreas Mosti">
<link rel="preload stylesheet" as=style href=https://andmos.github.io/blog.amosti.net/app.min.css>
<link rel=preload as=image href=https://andmos.github.io/blog.amosti.net/theme.png>
<link rel=preload as=image href=https://andmos.github.io/blog.amosti.net/twitter.svg>
<link rel=preload as=image href=https://andmos.github.io/blog.amosti.net/github.svg>
<link rel=icon href=https://andmos.github.io/blog.amosti.net/favicon.ico>
<link rel=apple-touch-icon href=https://andmos.github.io/blog.amosti.net/apple-touch-icon.png>
<meta name=generator content="Hugo 0.92.1">
<meta property="og:title" content="Github Actions and publishing artifacts to Azure Blob Storage">
<meta property="og:description" content="Intro Github Actions is a welcomed edition to the (still) growing world of CI/CD tools. Since Actions is Github&rsquo;s own tool, it integrates more closely to your repo and the Github Workflow, with actions to automate tasks around issues, pull-requests, releases etc. Writing a task that regularly, say, check issues and mark them as stalled if it hasn&rsquo;t been any activity for some time has, would mean leveraging the Github API when running in other tools, while abstractions for these kinds of integrations are present directly in Github Actions.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://andmos.github.io/blog.amosti.net/github-actions-and-publishing-artifacts-to-azure-blob-storage/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2019-10-03T14:59:13+00:00">
<meta property="article:modified_time" content="2019-10-03T14:59:13+00:00">
<meta itemprop=name content="Github Actions and publishing artifacts to Azure Blob Storage">
<meta itemprop=description content="Intro Github Actions is a welcomed edition to the (still) growing world of CI/CD tools. Since Actions is Github&rsquo;s own tool, it integrates more closely to your repo and the Github Workflow, with actions to automate tasks around issues, pull-requests, releases etc. Writing a task that regularly, say, check issues and mark them as stalled if it hasn&rsquo;t been any activity for some time has, would mean leveraging the Github API when running in other tools, while abstractions for these kinds of integrations are present directly in Github Actions."><meta itemprop=datePublished content="2019-10-03T14:59:13+00:00">
<meta itemprop=dateModified content="2019-10-03T14:59:13+00:00">
<meta itemprop=wordCount content="430">
<meta itemprop=keywords content>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Github Actions and publishing artifacts to Azure Blob Storage">
<meta name=twitter:description content="Intro Github Actions is a welcomed edition to the (still) growing world of CI/CD tools. Since Actions is Github&rsquo;s own tool, it integrates more closely to your repo and the Github Workflow, with actions to automate tasks around issues, pull-requests, releases etc. Writing a task that regularly, say, check issues and mark them as stalled if it hasn&rsquo;t been any activity for some time has, would mean leveraging the Github API when running in other tools, while abstractions for these kinds of integrations are present directly in Github Actions.">
</head>
<body class=not-ready data-menu=true>
<header class=header>
<p class=logo>
<a class=site-name href=https://andmos.github.io/blog.amosti.net>Dev&Ops</a><a class=btn-dark></a>
</p>
<script>let bodyClx=document.body.classList,btnDark=document.querySelector('.btn-dark'),sysDark=window.matchMedia('(prefers-color-scheme: dark)'),darkVal=localStorage.getItem('dark'),setDark=a=>{bodyClx[a?'add':'remove']('dark'),localStorage.setItem('dark',a?'yes':'no')};setDark(darkVal?darkVal==='yes':sysDark.matches),requestAnimationFrame(()=>bodyClx.remove('not-ready')),btnDark.addEventListener('click',()=>setDark(!bodyClx.contains('dark'))),sysDark.addEventListener('change',a=>setDark(a.matches))</script>
<nav class=menu>
<a href=/blog.amosti.net/about/>About Andreas</a>
</nav>
<nav class=social>
<a class=twitter style=--url:url(./twitter.svg) href=https://twitter.com/amostii target=_blank></a>
<a class=github style=--url:url(./github.svg) href=https://github.com/andmos target=_blank></a>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-title>
<p>
<time>Oct 3, 2019</time>
<span>Andreas Mosti</span>
</p>
<h1>Github Actions and publishing artifacts to Azure Blob Storage</h1>
</header>
<section class=post-content><h3 id=intro>Intro</h3>
<p><a href=https://github.com/features/actions>Github Actions</a> is a welcomed edition to the (still) growing world of CI/CD tools.
Since Actions is Github&rsquo;s own tool, it integrates more closely to your repo and the Github Workflow, with actions to automate tasks around issues, pull-requests, releases etc. Writing a task that regularly, say, check issues and mark them as stalled if it hasn&rsquo;t been any activity for some time has, would mean leveraging the Github API when running in other tools, while abstractions for these kinds of integrations are present directly in Github Actions. That makes their &ldquo;workflow&rdquo; semantics more comprehensive than just plain CI/CD capabilities.</p>
<p>Extendability is at the core of Github Actions. All workflows consists of one to many actions, and these actions can be run natively or via containers. Referencing a third party actions is as easy as knowing the action&rsquo;s github namespace.</p>
<script src=https://gist.github.com/andmos/22a0276f9288c9eb281fc49e6833a114.js></script>
<p>In this example the <em>workflow</em> <code>Tests</code> will trigger on <code>git push</code>, run on macOS, Ubuntu and Windows, checkout code with the action <a href=https://github.com/actions/checkout>actions/checkout</a>, and install Python via [actions/setup-python](https:(//github.com/actions/setup-python). These two actions are &ldquo;official&rdquo;, hence the &ldquo;actions&rdquo; namespace. The next task installs the Python package manager <a href=https://poetry.eustace.io/>Poetry</a> and is a third party action: <a href=https://github.com/dschep/install-poetry-action>dschep/install-poetry-action</a>. Since these actions directly reference living repositories, specifing a release or branch (<code>dschep/install-poetry-action@v1.2</code>) will save you from some unpleasant discoveries.</p>
<p>To speed up the build, these actions can be run directly from DockerHub:</p>
<script src=https://gist.github.com/andmos/1ddb8949fba768fc6373c91beab4f7a1.js></script>
<h3 id=uscase-upload-artifacts-to-azure-blob-storage>Uscase: Upload artifacts to Azure Blob Storage</h3>
<p>Github Actions is still in it&rsquo;s early days, so there are not actions for everything just yet. The other day I needed a workflow to build and publish an Electron App to MacOS and Linux, with the artifacts stored in Azure Blob Storage. In Azure Blob Storage we have two containers, one for <code>dev</code> and one for <code>release</code>, so the app can be tested before released out to the world. Here is the workflow:</p>
<script src=https://gist.github.com/andmos/416601771109493b49aba3591e3f7c2c.js></script>
<p>So this workflow will only trigger on push to the <code>dev</code> branch.
<a href=https://github.com/actions/setup-node>actions/setup-node@master</a> installs node on version <code>12.10</code>, and <code>electron-builder</code> is used to package and sign (the macOS) app. Here we also see secrets in play, <code>${{ secrets.BASE_64_CERT }}</code> holds an encryptet
signing certificate.</p>
<p>Finally, I could not find a suitable action for uploading to Azure Blob Storage directly, but going via <a href=https://github.com/azure/actions/>azure/actions/login</a> worked great to auth against Azure and give access to the <code>az</code> CLI. All that is needed is generating <a href="https://docs.microsoft.com/en-us/cli/azure/create-an-azure-service-principal-azure-cli?view=azure-cli-latest">Azure Service Principal</a> to give the workflow access to just the Blob Storage Containers, store them as a secret and we are good to go. For a great intro to using dotnet core with Github Actions, check out <a href=https://hjerpbakk.com/blog/2019/10/03/asp-net-core-and-github-actions>Runar&rsquo;s post</a>.</p>
</section>
<nav class=post-nav>
<a class=prev href=https://andmos.github.io/blog.amosti.net/automate-docker-base-image-updates-with-watchtower/><span>←</span><span>Automate Docker base image updates with Watchtower</span></a>
<a class=next href=https://andmos.github.io/blog.amosti.net/running-gbfs-bikeshare-functions-with-openfaas-for-fun-and-profit/><span>Running GBFS bikeshare functions with OpenFaaS for fun and profit</span><span>→</span></a>
</nav>
</article>
</main>
<footer class=footer>
<p>&copy; 2022 <a href=https://andmos.github.io/blog.amosti.net>Dev&Ops</a></p>
<p>Powered by <a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>️</p>
<p>
<a href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>Paper 5.1</a>
</p>
</footer>
</body>
</html>